<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestione Bollette Condominio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {background-color: #f8f9fa;}
    .card {box-shadow: 0 4px 8px rgba(0,0,0,0.1);}
  </style>
</head>
<body class="bg-light">
<div class="container py-5">
  <div class="card p-4">
    <h2 class="mb-4 text-center">Gestione Bollette Condominio</h2>

    <h5>Letture Scatti Mensili</h5>
    <div class="row">
      <div class="col-md-4">
        <label>Mese 1 - Appartamento 1:</label>
        <input type="number" id="apt1mese1" class="form-control">
      </div>
      <div class="col">
        <label>Mese 2 - Appartamento 1:</label>
        <input type="number" id="apt1mese2" class="form-control">
      </div>
      <div class="col">
        <label>Mese 1 - Appartamento 2:</label>
        <input type="number" id="apt2mese1" class="form-control">
      </div>
      <div class="col">
        <label>Mese 2 - Appartamento 2:</label>
        <input type="number" id="apt2mese2" class="form-control">
      </div>
      <div class="col">
        <label>Mese 1 - Appartamento 3:</label>
        <input type="number" id="apt3mese1" class="form-control">
      </div>
      <div class="col">
        <label>Mese 2 - Appartamento 3:</label>
        <input type="number" id="apt3mese2" class="form-control">
      </div>

    <h5 class="mt-4">Inserisci Dati Bolletta</h5>
    <input class="form-control my-2" id="totaleBolletta" placeholder="Importo totale bolletta (usa punto per i decimali)">

    <button class="btn btn-primary my-2" onclick="calcola()">Calcola Ripartizione</button>

    <div id="risultato" class="mt-4"></div>
    <div id="cronologia" class="mt-4"></div>
  </div>
</div>

<script>
let cronologia = JSON.parse(localStorage.getItem('cronologia')) || [];

function calcola() {
  let apt1 = (+document.getElementById('apt1mese2').value) - (+document.getElementById('apt1mese1').value);
  let apt2 = +document.getElementById('apt2mese2').value - +document.getElementById('apt2mese1').value;
  let apt3 = +document.getElementById('apt3mese2').value - +document.getElementById('apt3mese1').value;

  let totaleScatti = apt1 + apt2 + apt3;

  if (totaleScatti <= 0) {
    alert("Controlla le letture inserite!");
    return;
  }

  let totale = +document.getElementById('totaleBolletta').value.replace(',', '.');

  let risultatoHTML = `<h5>Ripartizione Spese:</h5>
    <ul class="list-group">
      <li class="list-group-item">Appartamento 1: €${(totale * apt1 / totaleScatti).toFixed(2)}</li>
      <li class="list-group-item">Appartamento 2: €${(totale * apt2 / totaleScatti).toFixed(2)}</li>
      <li class="list-group-item">Appartamento 3: €${(totale * apt3 / totaleScatti).toFixed(2)}</li>
    </ul>`;

  document.getElementById('risultato').innerHTML = risultatoHTML;

  cronologia.push({data: new Date().toLocaleDateString(), apt1, apt2, apt3, totale});
  localStorage.setItem('cronologia', JSON.stringify(cronologia));
  mostraCronologia();
}

function mostraCronologia() {
  let html = '<h5>Cronologia Bollette:</h5><ul class="list-group">';
  cronologia.forEach(item => {
    html += `<li class="list-group-item">${item.data}: Totale €${item.totale}, Apt1: ${item.apt1} scatti, Apt2: ${item.apt2} scatti, Apt3: ${item.apt3} scatti</li>`;
  });
  document.getElementById('cronologia').innerHTML = html;
}

window.onload = () => mostraCronologia();
</script>
</body>
</html>
