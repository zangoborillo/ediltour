<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Bollette Condominio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <h2 class="mt-4">Gestione Bollette Condominio</h2>

    <div class="my-3">
        <label>Scatti Appartamento 1:</label>
        <input type="number" id="apt1" class="form-control">
    </div>
    <div class="my-3">
        <label>Scatti Appartamento 2:</label>
        <input type="number" id="apt2" class="form-control">
    </div>
    <div class="my-3">
        <label>Scatti Appartamento 3:</label>
        <input type="number" id="apt3" class="form-control">
    </div>

    <h4>Dettagli Bolletta</h4>
    <input class="form-control mb-2" id="kwhTotale" placeholder="Totale kWh bolletta">
    <input class="form-control mb-2" id="materiaEnergia" placeholder="Spesa materia energia">
    <input class="form-control mb-2" id="scontoOfferta" placeholder="Sconto offerta (se previsto)">
    <input class="form-control mb-2" id="trasporto" placeholder="Spesa trasporto e gestione">
    <input class="form-control mb-2" id="oneriSistema" placeholder="Spesa oneri sistema">
    <input class="form-control mb-2" id="altrePartite" placeholder="Altre partite">
    <input class="form-control mb-2" id="imposte" placeholder="Imposte">
    <input class="form-control mb-2" id="iva" placeholder="IVA">

    <button class="btn btn-primary" onclick="calcola()">Calcola Ripartizione</button>

    <div id="risultato" class="mt-3"></div>

    <h4 class="mt-4">Cronologia Bollette</h4>
    <div id="cronologia"></div>
</div>

<script>
let cronologia = JSON.parse(localStorage.getItem('cronologia')) || [];

function calcola() {
    let scatti = [+document.getElementById('apt1').value,
                  +document.getElementById('apt2').value,
                  +document.getElementById('apt3').value];

    let totaleScatti = scattiTotali();

    let vociBolletta = ['materiaEnergia','scontoOfferta','trasporto','oneriSistema','iva'];
    let importi = vociBolletta.map(v => +(document.getElementById(v).value.replace(',', '.') || 0));

    let risultatoHTML = '<h5>Ripartizione Spese:</h5><ul class="list-group">';

    scatti.forEach((scatto, i) => {
        let totaleApt = vociBolletta.reduce((sum, voce) => {
            let importo = (+document.getElementById(voce).value.replace(',', '.') || 0);
            return sum + (importo * (scatto / totaleScatti));
        }, 0);

        risultatoHTML = `<li class="list-group-item">Appartamento ${i + 1}: â‚¬${totaleApt.toFixed(2)}</li>`;
        risultato.innerHTML += risultato;
    });

    risultato.innerHTML += '</ul>';
}

function scattiTotali(){
    return [+apt1.value,+apt2.value,+apt3.value].reduce((a,b)=>a+b,0);
}
</script>

</body>
</html>
